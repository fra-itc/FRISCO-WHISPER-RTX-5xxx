# Test Fixtures Directory

This directory contains test fixtures and sample files used by the pytest test suite.

## Automatically Generated Files

The following files are automatically generated by the test fixtures when tests are run:

### sample_audio.wav

- **Description**: A minimal 1-second silent audio file for testing
- **Format**: WAV (PCM 16-bit)
- **Sample Rate**: 16kHz
- **Channels**: Mono
- **Duration**: 1.0 second
- **Generation**: Automatically created by the `sample_audio_file` fixture in `conftest.py`

This file is used by:
- Unit tests for audio conversion
- Unit tests for transcription
- Integration tests for workflow validation

## Manual Test Files (Optional)

For more comprehensive testing, you can manually place the following files in this directory:

### sample_audio.m4a

- **Description**: Sample M4A audio file for testing M4A conversion
- **Recommended specs**:
  - Duration: 5-10 seconds
  - Sample rate: 44.1kHz or 48kHz
  - Content: Clear speech in a known language (English recommended)

**How to create**:
```bash
# Using ffmpeg to create a test M4A file from WAV
ffmpeg -i sample_audio.wav -c:a aac -b:a 128k sample_audio.m4a
```

### sample_audio.mp3

- **Description**: Sample MP3 audio file for testing MP3 conversion
- **Recommended specs**:
  - Duration: 5-10 seconds
  - Bitrate: 128-192 kbps
  - Content: Clear speech

**How to create**:
```bash
# Using ffmpeg to create a test MP3 file
ffmpeg -i sample_audio.wav -c:a libmp3lame -b:a 192k sample_audio.mp3
```

### long_audio.wav

- **Description**: Longer audio file for performance testing
- **Recommended specs**:
  - Duration: 1-5 minutes
  - Sample rate: 16kHz
  - Channels: Mono

**How to create**:
```python
# Python script to generate longer silent audio
import wave
import numpy as np

sample_rate = 16000
duration = 60.0  # 1 minute
num_samples = int(sample_rate * duration)
audio_data = np.zeros(num_samples, dtype=np.int16)

with wave.open('long_audio.wav', 'wb') as wav_file:
    wav_file.setnchannels(1)
    wav_file.setsampwidth(2)
    wav_file.setframerate(sample_rate)
    wav_file.writeframes(audio_data.tobytes())
```

### real_speech.wav

- **Description**: Real speech audio for accuracy testing
- **Recommended specs**:
  - Duration: 10-30 seconds
  - Sample rate: 16kHz
  - Content: Clear, known text for validation

**Where to get**:
- Record your own voice reading a known text
- Use public domain audio clips
- Use the LibriSpeech dataset samples

## Test File Organization

```
tests/fixtures/
├── README.md              # This file
├── sample_audio.wav       # Auto-generated by conftest.py
├── sample_audio.m4a       # Optional: Manual addition
├── sample_audio.mp3       # Optional: Manual addition
├── long_audio.wav         # Optional: For performance tests
└── real_speech.wav        # Optional: For accuracy validation
```

## Using Test Files in Tests

### In conftest.py fixtures

```python
@pytest.fixture(scope="session")
def sample_audio_file(test_data_dir):
    audio_path = test_data_dir / "sample_audio.wav"
    # File is automatically created if it doesn't exist
    return audio_path
```

### In test files

```python
def test_audio_conversion(sample_audio_file, temp_dir):
    # sample_audio_file is automatically provided
    result = convert_to_wav(sample_audio_file, temp_dir)
    assert result is not None
```

## Notes

- **Auto-generation**: The `sample_audio.wav` file is automatically created by the `sample_audio_file` fixture. You don't need to manually create it.

- **Optional files**: Other audio format files (M4A, MP3, etc.) are optional and only needed if you want to test those specific formats.

- **Test isolation**: Tests use temporary directories for outputs, so original fixture files are never modified.

- **File size**: Keep test files small (< 1MB) for fast test execution. Use `@pytest.mark.slow` for tests that require larger files.

- **Git tracking**:
  - `sample_audio.wav` is NOT tracked by git (auto-generated)
  - Manual test files can be added to `.gitignore` if they're large
  - This README is tracked to document the fixture structure

## Cleanup

Test fixtures are automatically cleaned up after test runs. Temporary files created during tests are deleted by the `temp_dir` fixture.

If you need to manually clean generated files:

```bash
# Remove auto-generated test files
rm tests/fixtures/sample_audio.wav

# Files will be regenerated on next test run
```

## Troubleshooting

### "File not found" errors

If tests fail with file not found errors:

1. Check that the `tests/fixtures/` directory exists
2. Ensure the `sample_audio_file` fixture is being used
3. The fixture will automatically create `sample_audio.wav` if missing

### Permission errors

If you encounter permission errors:

```bash
# On Linux/Mac, ensure the directory is writable
chmod -R u+w tests/fixtures/

# On Windows, check folder permissions in Properties
```

### Large file warnings

If you add large test files:

- Add them to `.gitignore` to avoid bloating the repository
- Use `pytest-benchmark` for performance testing with large files
- Consider using `@pytest.mark.slow` to skip them in fast test runs

## Related Documentation

- Test fixtures documentation: `tests/conftest.py`
- Running tests: See main `README.md`
- Pytest documentation: https://docs.pytest.org/
